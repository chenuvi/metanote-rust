---
date: 2025-05-13
title: 智能指针 Smart Pointer
---
指针（pointer）是一个通用概念，它指代那些包含内存地址的变量。

智能指针
eample: String 与 Vec<T>

引用和智能指针之间差别：
* 引用是用&符号表示的，会借用它所指向的值，**智能指针（smart pointer）是一些数据结构**;
* 引用是只借用数据的指针；而与之相反地，大多数智能指针本身就拥有它们指向的数据。


• Box<T>，可用于在堆上分配值。
• Rc<T>，允许多重所有权的引用计数类型。
• Ref<T>和RefMut<T>，可以通过RefCell<T>访问，是一种可以在运行时而不是编译时执行借用规则的类型。

Box

### `Deref` `Drop`

## Rc<T>
### 基于引用计数的智能指针Rc<T> (Reference counting 引用计数)

使用Rc<T>共享数据

** Rc<T>只能被用于单线程场景中 **

## RefCell<T>
### RefCell<T> 和内部可变性模式

** 与Rc<T>相似，RefCell<T>只能被用于单线程场景中, 强行将它用于多线程环境中会产生编译时错误。**

选择使用Box<T>、Rc<T>还是RefCell<T>的依据：
* Rc<T>允许一份数据有多个所有者，而Box<T>和RefCell<T>都只有一个所有者。
* Box<T>允许在编译时检查的可变或不可变借用，Rc<T>仅允许编译时检查的不可变借用，RefCell<T>允许运行时检查的可变或不可变借用。
* 由于RefCell<T>允许我们在运行时检查可变借用，所以即便RefCell<T>本身是不可变的，我们仍然能够更改其中存储的值。内部可变性模式允许用户更改一个不可变值的内部数据。
